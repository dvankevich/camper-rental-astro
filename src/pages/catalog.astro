---
// src/pages/catalog.astro
export const prerender = false; // Вимикаємо статичну генерацію для цієї сторінки
import Layout from "../layouts/Layout.astro";
import CamperCard from "../components/CamperCard.astro";
import Pagination from "../components/Pagination.astro"; // Імпорт нового компонента
import { fetchCampers } from "../lib/api";

// 1. Визначаємо поточну сторінку з URL (за замовчуванням 1)
const pageParam = Astro.url.searchParams.get("page");
// Надійний спосіб конвертації:
// Якщо не число або менше 1 -> завжди 1
const currentPage = Math.max(1, Number(pageParam) || 1);
// Для перевірки додайте лог:
console.log("pageParam: ", pageParam);
console.log(`Current page: ${currentPage}, Type: ${typeof currentPage}`);
const limit = 4;

// 2. Робимо запит
const { items: campers, total } = await fetchCampers({
  page: currentPage,
  limit,
});

// 3. Рахуємо загальну кількість сторінок
const totalPages = Math.ceil(total / limit);
console.log("total from API: ", total);
console.log("totalPages: ", totalPages);
---

<Layout title="Catalog">
  <section class="catalog-section">
    <div class="container">
      <div class="list-container">
        {/* Список кемперів */}
        {
          campers.length > 0 ? (
            <ul class="campers-list">
              {campers.map((camper) => (
                <li>
                  <CamperCard camper={camper} />
                </li>
              ))}
            </ul>
          ) : (
            <div class="empty-state">
              <p>No campers found.</p>
            </div>
          )
        }

        {/* Пагінація */}
        <Pagination
          currentPage={currentPage}
          totalPages={totalPages}
          baseUrl="/catalog"
        />
      </div>
    </div>
  </section>
</Layout>

<style>
  .catalog-section {
    padding: 64px 0;
  }
  .container {
    max-width: 1440px;
    margin: 0 auto;
    padding: 0 64px;
  }
  .campers-list {
    display: flex;
    flex-direction: column;
    gap: 32px;
    margin-bottom: 40px;
  }
</style>
